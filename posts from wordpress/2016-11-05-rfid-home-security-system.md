---
layout: post
title: RFID Home Security System
date: 2016-11-05 19:15
author: nickzanobini
comments: true
categories: [Uncategorized]
---
<p dir="ltr">My house and my garage weren't attached and after continuously having to go into the garage with my arms full I got tired of putting my stuff on the ground, digging my keys out of my pocket and unlocking my garage. That's when I decided there has to be a better way to get in to my garage. I did some research and decided building a RFID door lock would both solve my problems and be fun.  <br></p><p dir="ltr">Here’s what I used to build this project:</p><ul>	<li>My Macbook Pro</li>	<li>Arduino IDE</li><li>USB &nbsp;A to USB &nbsp;B cable</li><li>Arduino Mega</li><li>20x4 LCD Screen</li><li>Parallax RFID Reader<br></li><li>16 digit keypad<br></li><li>Jumper cables</li><li>Enclosure for the electronics</li><li>12VDC 300mA power supply</li><li>9VDC 500mA power supply</li><li>12V NC Electric Strike Plate</li><li>5V SPST&nbsp;Relay&nbsp;</li><li>Breadboard or soldering iron and solder</li><li>Zener switching diode?</li>	</ul><p></p><p dir="ltr"><br>I decided on building an RFID Door lock system with an optional password. First I started with just the Arduino and the RFID reader. I chose to use an Arduino Mega and the Parallax RFID because RadioShack had them on sale for $10 awhile ago and an electric door strike. I then expanded the system to include both a LCD screen and a 16 digit keypad.<br></p><p>I used a 12V relay to enable the door strike allowing the Arduino to grant access to the users.<br></p><p dir="ltr">Improvements: </p><ul><li><span>Build a small circuit so there’s only one power supply and regulate the voltage to the Arduino and the strike plate</span><br></li><li>Touch screen?</li><li>convert to a Raspberry Pi</li><li>trigger security camera to take a picture when user tries to swipe in</li><li>logging user&nbsp;attempts and time stamp&nbsp;to text file</li></ul><p>&nbsp;</p><p></p><p>Here is the code for the project and the wiring diagram.<br></p><p>[code language="cpp" light="true"]<br>// Updated 4/02/2015<br>// Nick Z.<br>// Keypad Door Lock<br>#include &lt;LiquidCrystal.h&gt;<br>#include &lt;Keypad.h&gt;<br></p><p>//constants for LEDs and Pins<br>int greenLED = 13;<br>int redLED = 12;<br>int RFIDEnablePin = 11;<br>int relay = 10;<br></p><p>LiquidCrystal lcd(8, 9, 4, 5, 6, 7);   <br></p><p>//set our employees<br>const byte numEmployees = 4;<br></p><p>// Array values are TAG ID, First Name, Last Name, Secret Code<br>char *employees[][4] = {<br>  {"1900711ACC","Jane","Doe","6566"},         // blue faab<br>  {"010D8EA279","Neil","Caffrey","1234"},     // black circle<br>  {"1600199FB3","Leroy","Gibbs","1234"},      // white circle<br>};<br></p><p>//setup the state table states<br>int currentState = 1;                 // State variable initialized to state 1 (read card)<br>const int waitingForTagID = 1;        // Waiting for Card input<br>const int waitingForPasscode = 2;     // Waiting for keypad input<br></p><p>// Misc Global Variables<br>char* ourCode;                        // Used to store the secret code for the user who's RFID was read<br>int currentPosition = 0;              // Used to remember the location of the code input<br>int  val = 0;                         // Used in reading the card<br>char code[10];                        // The TAG ID of the card<br>int bytesread = 0;                    // Used in reading the card<br>int currentEmployee;                  // The current employee being worked is stored here<br>long myTimer;                         // Used for the code entry timeout<br>char currPassword[4];<br>boolean passCheck;<br></p><p>// The name of the location for this reader.  This is displayed in the serial output<br>const char locationName[] = "Neils's Room";<br></p><p>//define the keypad<br>const byte rows = 4;<br>const byte cols = 4;<br></p><p>char keys[rows][cols] = {<br>  {'1','2','3','A'},<br>  {'4','5','6','B'},<br>  {'7','8','9','C'},<br>  {'*','0','#','D'}<br>};<br></p><p>byte rowPins[rows] = {38,40,42,44};<br>byte colPins[cols] = {46,48,50,52};<br></p><p>Keypad keypad = Keypad(makeKeymap(keys), rowPins, colPins, rows, cols);<br>/* ==================================    Setup    ================================== */<br>void setup() {<br></p><p>  Serial.begin(2400); // The RFID reader outputs at a whopping 2400 Baud<br>  Serial.println("Start Running");<br>  Serial.println("====================");<br></p><p>  pinMode(RFIDEnablePin, OUTPUT);   // Set as OUTPUT to connect it to the RFID /ENABLE pin<br>  digitalWrite(RFIDEnablePin, LOW); // Activate the RFID reader<br></p><p>  //setup and turn off both LEDs<br>  lcd.begin(16, 4);<br>  pinMode(redLED, OUTPUT);<br>  pinMode(greenLED, OUTPUT);<br>  digitalWrite(redLED, LOW);<br>  digitalWrite(greenLED, LOW);<br></p><p>  displayTagScanScreen();          //Put up default screen for reading the tags<br>}<br></p><p>void loop() {<br>  int l;<br>  int empid;<br></p><p>  switch (currentState)  {<br>    case waitingForTagID:<br>      digitalWrite(RFIDEnablePin, LOW);      // Enable RFID Reader<br></p><p>      if(Serial.available() &gt; 0) {           // if data available from reader<br>        if((val = Serial.read()) == 10) {    // check for header<br>          bytesread = 0; <br></p><p>          while(bytesread&lt;10) {              // read 10 digit code              if( Serial.available() &gt; 0) {<br>              val = Serial.read();<br>              if((val == 10)||(val == 13)) { // if header or stop bytes before the 10 digit reading<br>                break;                       // stop reading<br>              }<br>              code[bytesread] = val;         // add the digit<br>              bytesread++;                   // ready to read next digit<br>            }<br>          } <br></p><p>          if(bytesread == 10) {              // if 10 digit read is complete<br>            // Check to see if tag is valid and attached to an employee<br></p><p>            code[10] = '\0';                // Add null at end to terminate the string<br>             empid = getEmployee(code);     // Get the employee id of the tag read, -1 means no match<br>             if (empid == -1) {<br>               digitalWrite(RFIDEnablePin, HIGH);  // Turn off RFID Reader<br>               invalidCard();                      // Display invalid card message<br>               Serial.print("Unkown Code: ");<br>               Serial.println(code);<br>               digitalWrite(RFIDEnablePin, LOW);   // Turn on RFID reader<br>             } else {<br>               currentEmployee = empid;            // Store for future use<br>               displayCodeEntryScreen(employees[empid][1]);  //Display code entry screen with first name of employee<br>               currentState = waitingForPasscode;            // Change the state to waiting for passcode entry<br>               ourCode = employees[empid][3];                // Place the employee secret code into the code entry value<br>               Serial.println(ourCode);//TESTING<br>               clearSerial();                                // Clear any extra data on the serial port<br>               myTimer = millis();<br>             }<br>          } <br></p><p>          bytesread = 0; <br></p><p>        }<br>      }<br>      break;<br></p><p>    case waitingForPasscode:<br>      digitalWrite(RFIDEnablePin, HIGH);                    // Disable the RFID reader while doing code input<br></p><p>      // Nicks Added Code<br>      // Higer Security<br></p><p>      // Clear the asterisk area for code entry<br>      lcd.setCursor(14,3);<br>      lcd.print("    ");<br>      lcd.setCursor(14,3);<br></p><p>      for(int i=0; i&lt;=3; i++){<br>        currPassword[i] = keypad.waitForKey();<br>        lcd.print("*");<br>        Serial.print(currPassword[i]);//TESTING<br>      }<br>      Serial.println("");<br>      Serial.println(sizeof(currPassword));//TESTING<br>      Serial.println(currPassword);//TESTING<br></p><p>      for(int k=0; k&lt;4; k++){<br>        passCheck = true;<br>        char ourCodeTemp = ourCode[k];<br>        char currPasswordTemp = currPassword[k];<br>        if(ourCodeTemp != currPasswordTemp){<br>            passCheck = false;<br>        }<br>      }<br></p><p>      if ( passCheck ) {<br>        logEmployee(currentEmployee, true);<br>        unlockDoor();<br>        currentPosition = 0;<br>        currentState = waitingForTagID;<br>        clearSerial();<br>      } else if (currPassword != ourCode) {<br>        // Does not match so it is an invalid code<br>        logEmployee(currentEmployee, false);          // Log to the serial port the failue<br>        invalidCode();                                // Display invalid code screen<br>        currentPosition = 0;                          // Set the read position back to 0<br>        currentState = waitingForTagID;               // Change the state back to waiting for RFID read<br>        clearSerial();                                // Clear and junk that is on the serial port<br>      }<br>      // End of Nicks Code<br>  }<br>}<br></p><p>/***********************************************************************************************<br>  FUNCTION: getEmployee<br></p><p>  RETURNS:<br>    The array element id of the employee that matches the RFID TAG.  If no employee matches<br>    then -1 is returned.<br></p><p>  INPUTS:<br>    tagID (char)  : The value read from the RFID TAG<br></p><p>  COMMENTS:<br>    This function will take the tag id that was read from the RFID reader and loop through all<br>    employees looking for a match.  When it finds a match it returnes the element id for that<br>    employee.<br></p><p>    If all employees have been read without a match, it returns -1 for no match<br>***********************************************************************************************/<br>int getEmployee(char tagID[]) {<br>    int l;<br></p><p>    for (l=0; l&lt;numEmployees; ++l) {       if (strcmp(tagID, employees[l][0]) == 0)          return l;     }          return -1; } /***********************************************************************************************   FUNCTION: logEmployee      RETURNS:      NOTHING (void)        INPUTS:     empid (int)        : This is the employee id or element number from the employee array     grantAccess (int)  : If the emplyee was granted access then this is true, if the employee                          was denied access then this is false.        COMMENTS:     This function simply outputs to the serial port if a user was granted or denied access,     the user name and the location of this reader.          This function could be cleaned up by using sprintf to create a combined employee name (FOR),     the TO: as well.  But it was quick and used what we have talked about so far.     ***********************************************************************************************/ void logEmployee(int empid, int grantedAccess) {   if (grantedAccess) {     Serial.println("ACCESS GRANTED:");   } else {     Serial.println("ACCESS DENIED:");   }   Serial.print("  TO: ");   Serial.println(locationName);   Serial.print("  FOR: ");   Serial.print(employees[empid][1]);   Serial.print(" ");   Serial.println(employees[empid][2]);   Serial.println(" ");   Serial.println(" "); } /***********************************************************************************************   FUNCTION: clearSerial      RETURNS:      NOTHING (void)        INPUTS:     NONE        COMMENTS:     This function simply reads any data on the serial port until there is no more data.  It     is basically throwing away any extra input on the serial port effectivly clearing it.    ***********************************************************************************************/ void clearSerial() {   while (Serial.available() &gt; 0) {<br>    Serial.read();<br>  }<br>}<br></p><p>void invalidCode() {<br>  digitalWrite(redLED, HIGH);<br>  clearScreen();<br>  lcd.setCursor(0,0);<br>  lcd.print("********************");<br>  lcd.setCursor(0,1);<br>  lcd.print("** ACCESS DENIED! **");<br>  lcd.setCursor(0,2);<br>  lcd.print("**  INVALID CODE  **");<br>  lcd.setCursor(0,3);<br>  lcd.print("********************");<br></p><p>  delay(5000);<br>  digitalWrite(redLED, LOW);<br>  displayTagScanScreen();<br>}<br></p><p>void invalidCard() {<br>  digitalWrite(redLED, HIGH);<br>  clearScreen();<br>  lcd.setCursor(0,0);<br>  lcd.print("********************");<br>  lcd.setCursor(0,1);<br>  lcd.print("** ACCESS DENIED! **");<br>  lcd.setCursor(0,2);<br>  lcd.print("**  INVALID CARD  **");<br>  lcd.setCursor(0,3);<br>  lcd.print("********************");<br></p><p>  delay(5000);<br>  digitalWrite(redLED, LOW);<br>  displayTagScanScreen();<br>}<br></p><p>void unlockDoor() {<br>  digitalWrite(greenLED, HIGH);<br>  clearScreen();<br>  lcd.setCursor(0,0);<br>  lcd.print("********************");<br>  lcd.setCursor(0,1);<br>  lcd.print("** ACCESS GRANTED **");<br>  lcd.setCursor(0,2);<br>  lcd.print("**   WELCOME!!    **");<br>  lcd.setCursor(0,3);<br>  lcd.print("********************");<br></p><p>  digitalWrite(relay, HIGH); // Unlock door!<br>  delay(5000);<br>  digitalWrite(relay, LOW); // Unlock door!<br>  digitalWrite(greenLED, LOW);<br>  displayTagScanScreen();<br>}<br></p><p>void codeEntryTimeout() {<br>  digitalWrite(redLED, HIGH);<br>  clearScreen();<br>  lcd.setCursor(0,0);<br>  lcd.print("********************");<br>  lcd.setCursor(0,1);<br>  lcd.print("**   CODE ENTRY   **");<br>  lcd.setCursor(0,2);<br>  lcd.print("**   TIMEOUT!!    **");<br>  lcd.setCursor(0,3);<br>  lcd.print("********************");<br></p><p>  //add any code to unlock the door here<br>  delay(5000);<br>  digitalWrite(greenLED, LOW);<br>  displayTagScanScreen();<br>}<br></p><p>void displayTagScanScreen() {<br>  clearScreen();<br>  lcd.setCursor(0,0);<br>  lcd.print("     Welcome to     ");<br>  lcd.setCursor(0,1);<br>  lcd.print("    Nick's Room    ");<br>  lcd.setCursor(2,2);<br>  lcd.print("In order to enter");<br>  lcd.setCursor(3,3);<br>  lcd.print("Please Scan Tag");<br>}<br></p><p>void displayCodeEntryScreen(char *firstName) {<br>  clearScreen();<br>  lcd.setCursor(0,0);<br>  lcd.print("Welcome");<br>  lcd.setCursor(8,0);<br>  lcd.print(firstName);<br>  lcd.setCursor(0,2);<br>  lcd.print("Please Enter Your");<br>  lcd.setCursor(1,3);<br>  lcd.print("Secret Code:");<br>}<br></p><p>void clearScreen() {<br>  lcd.setCursor(0,0);<br>  lcd.print("                    ");<br>  lcd.setCursor(0,1);<br>  lcd.print("                    ");<br>  lcd.setCursor(0,2);<br>  lcd.print("                    ");<br>  lcd.setCursor(0,3);<br>  lcd.print("                    ");<br>}<br></p>[/code]
